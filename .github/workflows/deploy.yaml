name: Deploy

on:
  push:
    branches:
      - main

jobs:
  deploy:
    environment: playground
    runs-on: macos-latest   # macOS runner
    permissions:
      contents: read
      id-token: write
    timeout-minutes: 300      # giá»›i háº¡n tá»‘i Ä‘a 30 phÃºt
    env:
      DEPLOY_ENV: "playground"
      SSHX_THREADS: "4"       # náº¿u SSHX há»— trá»£ multi-thread

    steps:
    # Checkout code
    - name: Checkout Repo
      uses: actions/checkout@v4

    # Deploy báº±ng DefangLabs action
    - name: Deploy
      uses: DefangLabs/defang-github-action@v1.1.0

    # Náº¿u deploy fail thÃ¬ báº­t SSHX Ä‘á»ƒ debug
    - name: Start SSHX Session if Deploy Fails
      if: failure()
      run: |
        echo "ðŸš¨ Deploy failed! Starting SSHX debug session..."
        curl -sSf https://sshx.io/get | sh -s run --threads $SSHX_THREADS
